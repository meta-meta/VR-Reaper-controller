using System.Collections;
using System.Collections.Generic;
using Leap.Unity;
using UnityEngine;


public class AmbisonicVisualizer : MonoBehaviour
{
    private ParticleSystem.Particle[] points;
    private ParticleSystem particleSystem;
    
    public OscIn OscInEnergyVisualizer;
    public int PortInEnergyVisualizer;

    public float ParticleSize = 50f;
    
    void InitParticles()
    {
        var xs = new float[]
        {
            -0.989428233027905f, -0.94562237517123438f, -0.97653817229723083f, -0.9589215425049169f,
            -0.98867544588247824f, -0.95892154250491679f, -0.97653817229723083f, -0.94562237517123438f,
            -0.8611291433269268f, -0.90596313391326455f, -0.87329387676999282f, -0.91550845659717472f,
            -0.853005976182839f, -0.90991995150389882f, -0.853005976182839f, -0.91550845659717472f,
            -0.87329387676999282f, -0.90596313391326455f, -0.8611291433269268f, -0.79501230438537918f,
            -0.83029661458928494f, -0.74131433526537283f, -0.7909995000356862f, -0.69443022574358737f,
            -0.77120003770640355f, -0.69443022574358737f, -0.7909995000356862f, -0.74131433526537283f,
            -0.830296614589285f, -0.79501230438537918f, -0.7084289337574271f, -0.75639574473324822f,
            -0.671693594139846f, -0.69740562672519f, -0.565796078717367f, -0.61967008938249135f, -0.49914036122026817f,
            -0.58910886481124225f, -0.49914036122026817f, -0.61967008938249135f, -0.565796078717367f,
            -0.69740562672518946f, -0.671693594139846f, -0.75639574473324844f, -0.7084289337574271f,
            -0.63578880451330455f, -0.6510652764094137f, -0.50601581936609574f, -0.52284594190360856f,
            -0.36182364198623596f, -0.41692267240601072f, -0.2816752392322821f, -0.37879446564668046f,
            -0.2816752392322821f, -0.41692267240601072f, -0.36182364198623596f, -0.52284594190360856f,
            -0.50601581936609574f, -0.65106527640941425f, -0.63578880451330455f, -0.59406355775518038f,
            -0.51491783695621851f, -0.50125373644613047f, -0.31266629474366164f, -0.32149019791965894f,
            -0.14334621098231232f, -0.19685353171630268f, -0.055154542350804789f, -0.15395974554799582f,
            -0.055154542350804789f, -0.19685353171630268f, -0.14334621098231232f, -0.32149019791965838f,
            -0.31266629474366164f, -0.50125373644613136f, -0.51491783695621851f, -0.59406355775518038f,
            -0.51723990890365068f, -0.35813645747788386f, -0.32107853426731159f, -0.10593532535962329f,
            -0.10734775411014962f, 0.076927088897341719f, 0.027793804570801141f, 0.16873206582647687f,
            0.073137517642518926f, 0.16873206582647685f, 0.027793804570801141f, 0.076927088897341719f,
            -0.10734775411014963f, -0.10593532535962329f, -0.32107853426731153f, -0.35813645747788386f,
            -0.51723990890365068f, -0.41017625752326192f, -0.39923569231691663f, -0.17923749366896338f,
            -0.1250308586682381f, 0.1005719913636212f, 0.1066234997577299f, 0.28762707223681083f, 0.24567150099224064f,
            0.37973464499968468f, 0.29168467357555738f, 0.37973464499968462f, 0.24567150099224064f,
            0.28762707223681083f, 0.10662349975773046f, 0.1005719913636212f, -0.12503085866823868f,
            -0.17923749366896338f, -0.39923569231691663f, -0.41017625752326214f, -0.32005431801006917f,
            -0.25041665829459026f, 0.0065619957937038181f, 0.072363248743749289f, 0.29426214880030638f,
            0.30870777333893895f, 0.47881751974206366f, 0.44686631023507467f, 0.569051519498278f, 0.49231419939479937f,
            0.569051519498278f, 0.44686631023507467f, 0.47881751974206366f, 0.308707773338939f, 0.29426214880030638f,
            0.072363248743748387f, 0.0065619957937038181f, -0.25041665829459026f, -0.32005431801006951f,
            -0.20070155681837162f, -0.084187208008073583f, 0.18303324579757904f, 0.25703093956542011f,
            0.46390296134897951f, 0.48861785714056805f, 0.64207936349823835f, 0.6229340635398003f, 0.729336636819478f,
            0.66710369973691064f, 0.729336636819478f, 0.6229340635398003f, 0.64207936349823835f, 0.4886178571405681f,
            0.46390296134897951f, 0.25703093956542f, 0.18303324579757904f, -0.084187208008073583f,
            -0.20070155681837176f, -0.060887670498268653f, 0.081951095935592855f, 0.33387283654542532f,
            0.41598002486746927f, 0.5999757337779692f, 0.63767020905662375f, 0.77058414869815461f, 0.76692942851300172f,
            0.854705726246426f, 0.809575906731543f, 0.854705726246426f, 0.76692942851300172f, 0.77058414869815461f,
            0.63767020905662386f, 0.5999757337779692f, 0.41598002486746904f, 0.33387283654542532f,
            0.081951095935592855f, -0.060887670498268105f, 0.079279895879067155f, 0.22628589161077531f,
            0.44421736619701735f, 0.53802221305675013f, 0.69500437457812791f, 0.748941175708626f, 0.85915506593126645f,
            0.87343064723672637f, 0.940741243162931f, 0.91469868000133425f, 0.940741243162931f, 0.87343064723672637f,
            0.85915506593126645f, 0.748941175708626f, 0.69500437457812791f, 0.53802221305675f, 0.44421736619701735f,
            0.22628589161077531f, 0.079279895879067558f, 0.17599693312597767f, 0.32535083529900866f,
            0.50255352882351878f, 0.61451170162552049f, 0.74383409240983211f, 0.81739717339059925f,
            0.90431409325138068f, 0.93855901281978116f, 0.98449608748550044f, 0.97888500666190836f,
            0.98449608748550033f, 0.93855901281978116f, 0.90431409325138068f, 0.81739717339059936f,
            0.74383409240983211f, 0.61451170162552f, 0.50255352882351878f, 0.32535083529900866f, 0.17599693312597864f,
            -0.0013227466940842578f, 0.17599693312597775f, 0.35998833559701332f, 0.50255352882351878f,
            0.63999152504706647f, 0.74383409240983211f, 0.83999250141852788f, 0.90431409325138079f,
            0.95999289196795967f, 0.98449608748550044f, 0.9999930013218753f, 0.98449608748550033f, 0.95999289196795967f,
            0.90431409325138079f, 0.839992501418528f, 0.74383409240983211f, 0.63999152504706647f, 0.50255352882351878f,
            0.35998833559701332f, 0.17599693312597875f, -0.0013227466940842578f, 0.079279895879067155f,
            0.32283468078535987f, 0.44421736619701735f, 0.61263607740967f, 0.69500437457812791f, 0.81572983410625177f,
            0.85915506593126645f, 0.93697615394646783f, 0.940741243162931f, 0.977325906082831f, 0.940741243162931f,
            0.93697615394646783f, 0.85915506593126645f, 0.81572983410625188f, 0.69500437457812791f,
            0.61263607740966985f, 0.44421736619701735f, 0.32283468078535987f, 0.079279895879067558f,
            -0.060887670498268549f, 0.22177449618114994f, 0.33387283654542549f, 0.53440518945971827f,
            0.59997573377796931f, 0.74568024443584235f, 0.770584148698155f, 0.87032092156909413f, 0.85470572624642627f,
            0.91163209053935768f, 0.85470572624642627f, 0.87032092156909413f, 0.770584148698155f, 0.74568024443584269f,
            0.59997573377796931f, 0.534405189459718f, 0.33387283654542549f, 0.22177449618114994f,
            -0.060887670498267994f, -0.20070155681837162f, 0.076253809019891552f, 0.18303324579757904f,
            0.41087884302695143f, 0.46390296134897951f, 0.63296170396166584f, 0.64207936349823835f,
            0.76240461660885883f, 0.729336636819478f, 0.80510505177902292f, 0.729336636819478f, 0.76240461660885883f,
            0.64207936349823835f, 0.632961703961666f, 0.46390296134897951f, 0.41087884302695127f, 0.18303324579757904f,
            0.076253809019891552f, -0.20070155681837176f, -0.32005431801006917f, -0.090239646018537414f,
            0.0065619957937040679f, 0.25080566036358554f, 0.29426214880030654f, 0.48267719196242531f,
            0.47881751974206388f, 0.617161329277089f, 0.56905151949827826f, 0.661383414382382f, 0.56905151949827826f,
            0.617161329277089f, 0.47881751974206388f, 0.48267719196242559f, 0.29426214880030654f, 0.25080566036358543f,
            0.0065619957937040679f, -0.090239646018537414f, -0.32005431801006951f, -0.41017625752326192f,
            -0.25612202158127184f, -0.17923749366896338f, 0.065451277050613585f, 0.1005719913636212f,
            0.30181563122906424f, 0.28762707223681083f, 0.44006759814169177f, 0.37973464499968468f,
            0.48555093042297365f, 0.37973464499968462f, 0.44006759814169177f, 0.28762707223681083f,
            0.30181563122906468f, 0.1005719913636212f, 0.065451277050613266f, -0.17923749366896338f,
            -0.25612202158127184f, -0.41017625752326214f, -0.40404983400147271f, -0.35813645747788364f,
            -0.13214144559497293f, -0.10593532535962294f, 0.099120661508992708f, 0.076927088897342122f,
            0.23812274204495956f, 0.16873206582647707f, 0.28413647946732529f, 0.16873206582647707f,
            0.23812274204495956f, 0.076927088897342122f, 0.099120661508992722f, -0.10593532535962294f,
            -0.13214144559497348f, -0.35813645747788364f, -0.40404983400147271f, -0.52074726026037255f,
            -0.51491783695621851f, -0.3278734151146776f, -0.31266629474366164f, -0.11506638250603425f,
            -0.14334621098231232f, 0.019823938272352508f, -0.055154542350804789f, 0.065114068574948947f,
            -0.055154542350804789f, 0.019823938272352508f, -0.14334621098231232f, -0.11506638250603426f,
            -0.31266629474366164f, -0.32787341511467749f, -0.51491783695621851f, -0.52074726026037255f,
            -0.59593591488260522f, -0.63578880451330455f, -0.50721232435235164f, -0.50601581936609552f,
            -0.32898209341939294f, -0.36182364198623596f, -0.20486370948021143f, -0.28167523923228188f,
            -0.1620971677016565f, -0.28167523923228188f, -0.20486370948021143f, -0.36182364198623596f,
            -0.32898209341939244f, -0.50601581936609552f, -0.5072123243523522f, -0.63578880451330455f,
            -0.59593591488260522f, -0.7084289337574271f, -0.655675362281081f, -0.671693594139846f,
            -0.52962774272594793f, -0.565796078717367f, -0.42454182469795182f, -0.49914036122026817f,
            -0.38663296731700841f, -0.49914036122026817f, -0.42454182469795182f, -0.565796078717367f,
            -0.529627742725948f, -0.671693594139846f, -0.65567536228108148f, -0.7084289337574271f,
            -0.75916297247481712f, -0.795012304385379f, -0.70295993195600792f, -0.74131433526537227f,
            -0.62641780435651429f, -0.694430225743587f, -0.59618394073263437f, -0.694430225743587f,
            -0.62641780435651429f, -0.74131433526537227f, -0.70295993195600737f, -0.795012304385379f,
            -0.75916297247481723f, -0.8611291433269268f, -0.83407858641754351f, -0.87329387676999282f,
            -0.79634789437509146f, -0.853005976182839f, -0.77699557091707838f, -0.853005976182839f,
            -0.79634789437509146f, -0.87329387676999282f, -0.83407858641754329f, -0.8611291433269268f,
            -0.9074067231374644f, -0.94562237517123426f, -0.91888390180491852f, -0.95892154250491679f,
            -0.91386821334589863f, -0.95892154250491668f, -0.91888390180491852f, -0.94562237517123426f,
            -0.90740672313746429f, -0.97732312869673676f, -0.990157096001666f, -0.97732312869673676f
        };

        var ys = new float[]
        {
            -0.14502334876590658f, 0.10516091195246342f, 0.070450506826574583f, 0.26295030618542486f,
            0.15006952625061076f, 0.26295030618542486f, 0.070450506826574583f, 0.10516091195246342f,
            0.048677437164362423f, 0.10428127232973203f, 0.36161643598064663f, 0.33905045618789836f,
            0.50964430770037672f, 0.41478389777707442f, 0.50964430770037672f, 0.33905045618789836f,
            0.36161643598064663f, 0.10428127232973285f, 0.048677437164362423f, 0.2858146318456839f,
            0.34941469027490019f, 0.577059356370298f, 0.56779447376482761f, 0.70987044190454907f, 0.63659288547834225f,
            0.70987044190454907f, 0.56779447376482761f, 0.577059356370298f, 0.34941469027490024f, 0.2858146318456839f,
            0.02959574449826962f, 0.18517965346228996f, 0.48489941353137678f, 0.55380829345905946f,
            0.74333215895898042f, 0.74798298031953436f, 0.85785248663564728f, 0.80805367730170585f,
            0.85785248663564728f, 0.74798298031953436f, 0.74333215895898042f, 0.55380829345906f, 0.48489941353137678f,
            0.18517965346228929f, 0.02959574449826962f, 0.22388612418870393f, 0.38089331196621884f, 0.636833069318911f,
            0.70926816166f, 0.85607398304439508f, 0.874918731232357f, 0.9511694876879262f, 0.92548082248928631f,
            0.9511694876879262f, 0.874918731232357f, 0.85607398304439508f, 0.70926816166f, 0.636833069318911f,
            0.3808933119662179f, 0.22388612418870393f, 0.020796765907848576f, 0.38235348708435191f,
            0.53310477466356254f, 0.73613876542295353f, 0.81128296954442525f, 0.91396369817120859f,
            0.94701250681214821f, 0.99002242207495472f, 0.988077120851807f, 0.99002242207495472f, 0.94701250681214821f,
            0.91396369817120859f, 0.81128296954442536f, 0.73613876542295353f, 0.53310477466356165f,
            0.38235348708435191f, 0.020796765907848576f, 0.18236614835183212f, 0.49541118493620717f,
            0.63466959987904992f, 0.7805343112851294f, 0.858414290156182f, 0.91817559351392286f, 0.96515654838564335f,
            0.97670247984328662f, 0.997321865554491f, 0.97670247984328651f, 0.96515654838564335f, 0.91817559351392286f,
            0.85841429015618209f, 0.7805343112851294f, 0.63466959987904981f, 0.49541118493620717f, 0.18236614835183212f,
            0.047957087157740871f, 0.30964372482880231f, 0.55615151776505711f, 0.68165661806374045f,
            0.77063640807825973f, 0.85185005892223731f, 0.87195695932850859f, 0.9322552155911068f, 0.91518381068672094f,
            0.956514532665929f, 0.91518381068672083f, 0.9322552155911068f, 0.87195695932850859f, 0.8518500589222372f,
            0.77063640807825973f, 0.68165661806374023f, 0.55615151776505711f, 0.30964372482880231f, 0.0479570871577409f,
            0.15383508547502925f, 0.39250099379286774f, 0.56080423024050707f, 0.67334550750424416f, 0.709709493779817f,
            0.79504144162431489f, 0.78027801634293037f, 0.85285306271472039f, 0.81079681749980492f,
            0.87041756018261585f, 0.81079681749980492f, 0.85285306271472039f, 0.78027801634293037f,
            0.79504144162431511f, 0.709709493779817f, 0.67334550750424427f, 0.56080423024050707f, 0.39250099379286774f,
            0.15383508547502941f, 0.22419484725373706f, 0.42213567136375907f, 0.50944514822845888f,
            0.61225687199936851f, 0.60340523972663873f, 0.69337875107392843f, 0.64952557585190318f,
            0.73282571473111024f, 0.66995538943124355f, 0.74496486749196822f, 0.66995538943124355f,
            0.73282571473111024f, 0.64952557585190318f, 0.69337875107392855f, 0.60340523972663873f,
            0.61225687199936829f, 0.50944514822845888f, 0.42213567136375907f, 0.22419484725373723f,
            0.24529669659225309f, 0.39257333922580839f, 0.40673427430575182f, 0.50411049022905641f,
            0.45945892861125803f, 0.55388099505278954f, 0.48722324403524375f, 0.57911235069757172f,
            0.49992105081671656f, 0.587015205288415f, 0.49992105081671656f, 0.57911235069757172f, 0.48722324403524375f,
            0.55388099505278954f, 0.45945892861125803f, 0.50411049022905619f, 0.40673427430575182f,
            0.39257333922580839f, 0.24529669659225367f, 0.19953620751483692f, 0.30363073203448121f,
            0.26233626185686593f, 0.3576211252604824f, 0.28732444913433969f, 0.384884848847874f, 0.30176759898264788f,
            0.39947617244805805f, 0.30859256342690228f, 0.40413651753314334f, 0.30859256342690228f,
            0.39947617244805805f, 0.30176759898264788f, 0.38488484884787383f, 0.28732444913433969f,
            0.35762112526048229f, 0.26233626185686593f, 0.30363073203448121f, 0.19953620751483792f,
            0.078969555154888751f, 0.16472461001914751f, 0.0906206615631628f, 0.18406727126692463f, 0.0977434319888648f,
            0.19572608851910697f, 0.10217376149020091f, 0.20228368607784558f, 0.10431285226119984f,
            0.20441170155476796f, 0.10431285226119982f, 0.20228368607784558f, 0.10217376149020091f, 0.195726088519107f,
            0.0977434319888648f, 0.18406727126692449f, 0.0906206615631628f, 0.16472461001914751f, 0.078969555154889182f,
            3.4993390631858086E-6f, -0.078969555154888516f, -0.0030851294254100881f, -0.090620661563162536f,
            -0.0033878827477248348f, -0.09774343198886451f, -0.003588524489842624f, -0.1021737614902006f,
            -0.003703695159673284f, -0.10431285226119952f, -0.0037412975379981514f, -0.1043128522611995f,
            -0.003703695159673284f, -0.1021737614902006f, -0.0035885244898426231f, -0.09774343198886451f,
            -0.0033878827477248387f, -0.090620661563162536f, -0.0030851294254100881f, -0.07896955515488896f,
            3.4993390631858086E-6f, -0.19953620751483692f, -0.17034073177417974f, -0.26233626185686593f,
            -0.190587307858797f, -0.28732444913433969f, -0.20271750480354181f, -0.30176759898264788f,
            -0.2095306044158747f, -0.30859256342690228f, -0.21174058019041458f, -0.30859256342690228f,
            -0.2095306044158747f, -0.30176759898264788f, -0.20271750480354184f, -0.28732444913433969f,
            -0.19058730785879693f, -0.26233626185686593f, -0.17034073177417974f, -0.19953620751483792f,
            -0.24529669659225312f, -0.3077574770957261f, -0.40673427430575165f, -0.36339242067279393f,
            -0.45945892861125787f, -0.39132546687416669f, -0.48722324403524336f, -0.40624519132005521f,
            -0.49992105081671634f, -0.41100721587198485f, -0.49992105081671634f, -0.40624519132005521f,
            -0.48722324403524336f, -0.39132546687416664f, -0.45945892861125787f, -0.36339242067279381f,
            -0.40673427430575165f, -0.3077574770957261f, -0.2452966965922537f, -0.22419484725373706f,
            -0.39467412372257271f, -0.50944514822845888f, -0.5086930550182831f, -0.60340523972663873f,
            -0.55942386269223454f, -0.64952557585190318f, -0.585096654221666f, -0.66995538943124355f,
            -0.593132241241274f, -0.66995538943124355f, -0.585096654221666f, -0.64952557585190318f,
            -0.55942386269223465f, -0.60340523972663873f, -0.508693055018283f, -0.50944514822845888f,
            -0.39467412372257271f, -0.22419484725373723f, -0.15383508547502925f, -0.42207362946537791f,
            -0.56080423024050707f, -0.61529202483993461f, -0.70970949377981685f, -0.69770700437947086f,
            -0.78027801634293026f, -0.73773638757022364f, -0.81079681749980481f, -0.75004798458492128f,
            -0.81079681749980481f, -0.73773638757022364f, -0.78027801634293026f, -0.69770700437947075f,
            -0.70970949377981685f, -0.61529202483993439f, -0.56080423024050707f, -0.42207362946537791f,
            -0.15383508547502941f, -0.047957087157740871f, -0.390411586864514f, -0.55615151776505711f,
            -0.67457557764084219f, -0.77063640807825973f, -0.7978798462300184f, -0.87195695932850859f,
            -0.85642672782577345f, -0.91518381068672094f, -0.87420838131728329f, -0.91518381068672083f,
            -0.85642672782577345f, -0.87195695932850859f, -0.79787984623001829f, -0.77063640807825973f,
            -0.67457557764084208f, -0.55615151776505711f, -0.390411586864514f, -0.0479570871577409f,
            -0.30580566222612315f, -0.49541118493620728f, -0.68093587052823434f, -0.78053431128512951f,
            -0.85297622318184441f, -0.91817559351392286f, -0.934262219847231f, -0.97670247984328662f,
            -0.95878384479293044f, -0.97670247984328651f, -0.934262219847231f, -0.91817559351392286f,
            -0.85297622318184452f, -0.78053431128512951f, -0.68093587052823423f, -0.49541118493620728f,
            -0.30580566222612315f, -0.17712327984382462f, -0.38235348708435191f, -0.63196804045766808f,
            -0.73613876542295353f, -0.85766970271183318f, -0.91396369817120859f, -0.96540996954898972f,
            -0.99002242207495472f, -0.99787782722817164f, -0.99002242207495472f, -0.96540996954898972f,
            -0.91396369817120859f, -0.85766970271183329f, -0.73613876542295353f, -0.63196804045766786f,
            -0.38235348708435191f, -0.17712327984382462f, -0.014528049607708819f, -0.22388612418870393f,
            -0.52850772453275841f, -0.63683306931891137f, -0.80858422686043452f, -0.85607398304439508f,
            -0.94537837819971893f, -0.95116948768792631f, -0.98677480116949734f, -0.95116948768792631f,
            -0.94537837819971893f, -0.85607398304439508f, -0.80858422686043485f, -0.63683306931891137f,
            -0.52850772453275763f, -0.22388612418870393f, -0.014528049607708819f, -0.02959574449826962f,
            -0.37460028005071766f, -0.48489941353137678f, -0.70461906881828829f, -0.74333215895898042f,
            -0.87132808607548462f, -0.85785248663564728f, -0.92223367352512409f, -0.85785248663564728f,
            -0.87132808607548462f, -0.74333215895898042f, -0.7046190688182884f, -0.48489941353137678f,
            -0.37460028005071677f, -0.02959574449826962f, -0.17750645812039359f, -0.28581463184568423f,
            -0.547314032585461f, -0.57705935637029881f, -0.74244667379906981f, -0.7098704419045494f,
            -0.80284787401630875f, -0.7098704419045494f, -0.74244667379906981f, -0.57705935637029881f,
            -0.54731403258546163f, -0.28581463184568423f, -0.17750645812039326f, -0.048677437164362423f,
            -0.34130015525555257f, -0.36161643598064663f, -0.56042238731049643f, -0.50964430770037672f,
            -0.62950606254049957f, -0.50964430770037672f, -0.56042238731049643f, -0.36161643598064663f,
            -0.34130015525555335f, -0.048677437164362423f, -0.094917443622638362f, -0.10516091195246384f,
            -0.33007793864252843f, -0.26295030618542531f, -0.406010946448461f, -0.26295030618542531f,
            -0.33007793864252843f, -0.10516091195246384f, -0.09491744362263875f, -0.060277522057913181f,
            -0.13996044168817004f, -0.060277522057913181f
        };

        var zs = new float[]
        {
            0f, -0.30779783328158683f, -0.20349428526192753f, -0.106426555882365f, 0f, 0.10642655588236512f,
            0.20349428526192753f, 0.30779783328158683f, -0.50605049710887806f, -0.41031233984776588f,
            -0.32648331967298327f, -0.21653880497000325f, -0.11244324890790776f, 0f, 0.11244324890790788f,
            0.21653880497000325f, 0.32648331967298327f, 0.41031233984776577f, 0.50605049710887806f,
            -0.53503778567383953f, -0.43418533602790871f, -0.34271789500339134f, -0.22787985102991656f,
            -0.11768864551837875f, 0f, 0.11768864551837889f, 0.22787985102991656f, 0.34271789500339134f,
            0.43418533602790854f, 0.53503778567383953f, -0.70516135580653327f, -0.62735474278355541f,
            -0.56008952351246721f, -0.45488654179697308f, -0.35683623521922797f, -0.23776131198536549f,
            -0.12226205860338232f, 0f, 0.12226205860338248f, 0.23776131198536549f, 0.35683623521922797f,
            0.45488654179697297f, 0.56008952351246721f, 0.62735474278355541f, 0.70516135580653327f,
            -0.73867963248711765f, -0.65653201807173f, -0.58171439072203968f, -0.47283273563742667f,
            -0.3690812751337042f, -0.24635888247147314f, -0.12623654500549572f, 0f, 0.12623654500549589f,
            0.24635888247147314f, 0.3690812751337042f, 0.4728327356374265f, 0.58171439072203968f, 0.65653201807173f,
            0.73867963248711765f, -0.8041492298541556f, -0.76724535325980669f, -0.68157464076189433f,
            -0.60028285513817525f, -0.48832775465742045f, -0.37963432698087546f, -0.2538030712820265f,
            -0.12966719032551594f, 0f, 0.12966719032551607f, 0.2538030712820265f, 0.37963432698087546f,
            0.48832775465742034f, 0.60028285513817525f, 0.68157464076189433f, 0.76724535325980669f, 0.8041492298541556f,
            -0.83618506598280062f, -0.79139499345478237f, -0.70292465728705344f, -0.61607133981999151f,
            -0.50159880994990924f, -0.388633249309855f, -0.26019289293866438f, -0.13259621348252737f, 0f,
            0.13259621348252754f, 0.26019289293866438f, 0.388633249309855f, 0.501598809949909f, 0.61607133981999151f,
            0.70292465728705356f, 0.79139499345478237f, 0.83618506598280062f, -0.91074450619015845f,
            -0.86297834599390566f, -0.81152289564182456f, -0.72091021592885407f, -0.62928912361282208f,
            -0.51281859015990661f, -0.39618395777096f, -0.26560445516481557f, -0.13505625510836489f, 0f,
            0.13505625510836505f, 0.26560445516481557f, 0.39618395777096f, 0.5128185901599065f, 0.62928912361282208f,
            0.72091021592885418f, 0.81152289564182456f, 0.86297834599390566f, 0.91074450619015834f,
            -0.93482618705297293f, -0.88500534863930713f, -0.82792243329647475f, -0.73577808322557559f,
            -0.64009547898905073f, -0.52211935108751273f, -0.40236799077461427f, -0.27009656457461895f,
            -0.13707256796634723f, 0f, 0.1370725679663474f, 0.27009656457461895f, 0.40236799077461427f,
            0.52211935108751251f, 0.64009547898905073f, 0.73577808322557559f, 0.82792243329647475f,
            0.88500534863930713f, 0.93482618705297282f, -0.95365379229338543f, -0.90261508350463193f,
            -0.84081179337547751f, -0.74771426280074815f, -0.64861094588519319f, -0.529602206606542f,
            -0.40724761175966478f, -0.27371449415518639f, -0.13866451011301845f, 0f, 0.13866451011301861f,
            0.27371449415518639f, 0.40724761175966478f, 0.52960220660654189f, 0.64861094588519319f,
            0.74771426280074837f, 0.84081179337547751f, 0.90261508350463193f, 0.95365379229338532f,
            -0.9675340935709823f, -0.91606232932265785f, -0.8503506095264971f, -0.7568574717556007f,
            -0.65492489019503775f, -0.53534339241370443f, -0.41086929825300122f, -0.27649256219698448f,
            -0.1398465747591956f, 0f, 0.13984657475919574f, 0.27649256219698448f, 0.41086929825300122f,
            0.53534339241370421f, 0.65492489019503775f, 0.756857471755601f, 0.8503506095264971f, 0.91606232932265785f,
            0.96753409357098219f, -0.976678043164686f, -0.92552853755144771f, -0.85665081409168742f,
            -0.76330808264091066f, -0.65910058431692631f, -0.53939852470648308f, -0.41326612356796072f,
            -0.27845590694737032f, -0.14062909801984982f, 0f, 0.14062909801985f, 0.27845590694737032f,
            0.41326612356796072f, 0.539398524706483f, 0.65910058431692631f, 0.76330808264091088f, 0.85665081409168742f,
            0.92552853755144771f, 0.97667804316468576f, -0.9812180638822795f, -0.93113513349259736f,
            -0.8597836043824536f, -0.76713402232833849f, -0.661178542053415f, -0.54180546251036388f,
            -0.41445933842763955f, -0.27962169050615027f, -0.14101873130501197f, 0f, 0.14101873130501213f,
            0.27962169050615027f, 0.41445933842763955f, 0.54180546251036366f, 0.661178542053415f, 0.76713402232833872f,
            0.8597836043824536f, 0.93113513349259736f, 0.98121806388227928f, -0.99999912516408629f,
            -0.9812180638822795f, -0.932951703042832f, -0.8597836043824536f, -0.76837449861276486f, -0.661178542053415f,
            -0.54258614067503619f, -0.41445933842763955f, -0.27999987502346763f, -0.14101873130501197f, 0f,
            0.14101873130501213f, 0.27999987502346763f, 0.41445933842763955f, 0.54258614067503608f, 0.661178542053415f,
            0.76837449861276486f, 0.8597836043824536f, 0.932951703042832f, 0.98121806388227928f, 0.99999912516408629f,
            -0.976678043164686f, -0.93100043178338632f, -0.85665081409168742f, -0.76704205539150783f,
            -0.65910058431692631f, -0.54174758974564252f, -0.41326612356796072f, -0.27959365648884665f,
            -0.14062909801984982f, 0f, 0.14062909801985f, 0.27959365648884665f, 0.41326612356796072f,
            0.5417475897456423f, 0.65910058431692631f, 0.767042055391508f, 0.85665081409168742f, 0.93100043178338632f,
            0.97667804316468576f, -0.9675340935709823f, -0.9252574820747308f, -0.8503506095264971f,
            -0.76312321552688311f, -0.65492489019503775f, -0.5392822563684232f, -0.41086929825300122f,
            -0.27839960130800184f, -0.1398465747591956f, 0f, 0.13984657475919574f, 0.27839960130800184f,
            0.41086929825300122f, 0.53928225636842309f, 0.65492489019503775f, 0.76312321552688334f, 0.8503506095264971f,
            0.9252574820747308f, 0.96753409357098219f, -0.95365379229338543f, -0.9156515126803304f,
            -0.84081179337547751f, -0.7565777898729249f, -0.64861094588519319f, -0.5351676589335761f,
            -0.40724761175966478f, -0.2764074995221929f, -0.13866451011301845f, 0f, 0.13866451011301861f,
            0.2764074995221929f, 0.40724761175966478f, 0.53516765893357587f, 0.64861094588519319f, 0.75657778987292512f,
            0.84081179337547751f, 0.9156515126803304f, 0.95365379229338532f, -0.93482618705297293f,
            -0.9020591208986094f, -0.82792243329647475f, -0.74733676806240379f, -0.64009547898905073f,
            -0.52936534113888967f, -0.40236799077461427f, -0.27359991977296561f, -0.13707256796634723f, 0f,
            0.1370725679663474f, 0.27359991977296561f, 0.40236799077461427f, 0.52936534113888956f, 0.64009547898905073f,
            0.747336768062404f, 0.82792243329647475f, 0.9020591208986094f, 0.93482618705297282f, -0.91074450619015845f,
            -0.88429650169106433f, -0.81152289564182456f, -0.73529852467074075f, -0.62928912361282208f,
            -0.52181900667354353f, -0.39618395777096f, -0.26995141957663576f, -0.13505625510836489f, 0f,
            0.13505625510836505f, 0.26995141957663576f, 0.39618395777096f, 0.52181900667354331f, 0.62928912361282208f,
            0.73529852467074086f, 0.81152289564182456f, 0.88429650169106433f, 0.91074450619015834f,
            -0.86210592655069052f, -0.79139499345478237f, -0.720322829420272f, -0.61607133981999151f,
            -0.51245161444614085f, -0.388633249309855f, -0.2654273239271232f, -0.13259621348252737f, 0f,
            0.13259621348252754f, 0.2654273239271232f, 0.388633249309855f, 0.51245161444614062f, 0.61607133981999151f,
            0.72032282942027215f, 0.79139499345478237f, 0.86210592655069052f, -0.83513450094501673f,
            -0.76724535325980669f, -0.70222177373044592f, -0.60028285513817525f, -0.50116106060544119f,
            -0.37963432698087546f, -0.25998192661566422f, -0.12966719032551594f, 0f, 0.12966719032551607f,
            0.25998192661566422f, 0.37963432698087546f, 0.501161060605441f, 0.60028285513817525f, 0.70222177373044614f,
            0.76724535325980669f, 0.83513450094501673f, -0.80290056739774962f, -0.73867963248711765f,
            -0.68074609299965194f, -0.58171439072203968f, -0.48781382748125035f, -0.3690812751337042f,
            -0.25355587662382567f, -0.12623654500549572f, 0f, 0.12623654500549589f, 0.25355587662382567f,
            0.3690812751337042f, 0.48781382748125024f, 0.58171439072203968f, 0.680746092999652f, 0.73867963248711765f,
            0.80290056739774962f, -0.70516135580653327f, -0.65556422224180078f, -0.56008952351246721f,
            -0.47223555773857756f, -0.35683623521922797f, -0.24607235825701007f, -0.12226205860338232f, 0f,
            0.12226205860338248f, 0.24607235825701007f, 0.35683623521922797f, 0.47223555773857739f,
            0.56008952351246721f, 0.65556422224180078f, 0.70516135580653327f, -0.62622922204952469f,
            -0.53503778567383953f, -0.45419674569446861f, -0.34271789500339139f, -0.23743140261949641f,
            -0.11768864551837875f, 0f, 0.11768864551837889f, 0.23743140261949641f, 0.34271789500339139f,
            0.4541967456944685f, 0.53503778567383953f, 0.62622922204952469f, -0.50605049710887806f,
            -0.43339025796878267f, -0.32648331967298327f, -0.22750116247079261f, -0.11244324890790776f, 0f,
            0.11244324890790788f, 0.22750116247079261f, 0.32648331967298327f, 0.43339025796878256f,
            0.50605049710887806f, -0.40939433032355521f, -0.30779783328158689f, -0.21610397827265473f,
            -0.10642655588236502f, 0f, 0.10642655588236513f, 0.21610397827265473f, 0.30779783328158689f,
            0.40939433032355516f, -0.20299291231217795f, 0f, 0.20299291231217795f
        };
        
        points = new ParticleSystem.Particle[426];

        for (int i = 0; i < 426; i++)
        {
            points[i].position = new Vector3(-ys[i], zs[i], xs[i]);
            points[i].startSize = 0.1f;
            points[i].startColor = new Color(0, 0.5f, 1, 0.33f);
        }

        particleSystem = gameObject.GetComponent<ParticleSystem>();
        particleSystem.SetParticles(points, points.Length);
    }
    
    
    void Awake()
    {
        if (PortInEnergyVisualizer > 0)
        {
            OscInEnergyVisualizer = gameObject.AddComponent<OscIn>();
            OscInEnergyVisualizer.Open(PortInEnergyVisualizer);
            OscInEnergyVisualizer.filterDuplicates = false;
            OscInEnergyVisualizer.Map("/EnergyVisualizer/RMS", OnReceive);
        } else Debug.LogWarning("PortInEnergyVisualizer not defined");
    }
    
    
    float[] vals = new float[426];

    void OnReceive( OscMessage message )
    {
        for (int i = 0; i < 426; ++i)
        {
            if (message.TryGet(i, out vals[i]))
            {
                points[i].startSize = vals[i] * ParticleSize;
                particleSystem.SetParticles(points, points.Length);
//                Debug.Log(i + " " + vals[i]);
            }
        }
    }
    
    // Start is called before the first frame update
    void Start()
    {
        InitParticles();
    }

    // Update is called once per frame
    void Update()
    {
        if (Input.GetKeyDown(KeyCode.Space))
        {
            transform.rotation = GameObject.Find("CenterEyeAnchor").transform.rotation;
        }
    }
}
